"use strict";(self.webpackChunkotpuskaet=self.webpackChunkotpuskaet||[]).push([[292],{18292:(e,t,n)=>{n.r(t),n.d(t,{default:()=>He});var r=n(67294),a=n(67177),o=n(24404),i=n(73457),l=n(3119),s=n(97444),c=n(49892),u=n(67815);const d={temp:{width:"100%",height:"100%",borderRadius:0,borderWidth:0},bottomBar:{flex:(0,u.lv)()?1.3:1.6,paddingHorizontal:(0,u.lv)()?"20%":"1%",backgroundColor:"#FFFFFF"+s.Z["80%"],flexDirection:"row",justifyContent:"space-evenly",position:"relative",margin:0,bottom:0},localButton:{display:"flex",alignSelf:"center",alignItems:"center",justifyContent:"center"},actionSheetButton:{width:25,height:25},localButtonSmall:{display:"flex",alignSelf:"center",alignItems:"center",justifyContent:"center"},localButtonText:{fontFamily:"Source Sans Pro",fontSize:12,marginTop:4,fontWeight:"400"},localButtonWithoutBG:{borderRadius:23,borderColor:"#099DFD",borderWidth:0,width:40,height:40,padding:3,display:"flex",alignSelf:"center",alignItems:"center",justifyContent:"center"},fullWidthButton:{width:"100%",height:"100%",resizeMode:"contain"},endCall:{width:20,height:20},endCallContainer:{flexDirection:"row",justifyContent:"center",alignItems:"center",paddingVertical:8,paddingHorizontal:16,backgroundColor:"#FF414D",borderRadius:8},endCallText:{color:"#FFFFFF",fontFamily:c.Z.FontFamily.sansPro,fontSize:12,marginLeft:8,fontWeight:"700"},remoteButton:{width:25,height:25,borderTopRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,borderWidth:0,borderRightWidth:0,borderLeftWidth:0,marginHorizontal:0,backgroundColor:"#FFFFFF"},liveStreamHostControlBtns:{width:20,height:20,borderTopRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,borderWidth:0,borderRightWidth:0,borderLeftWidth:0,marginHorizontal:0,backgroundColor:"#FFFFFF"},minCloseBtn:{alignItems:"center",justifyContent:"center",width:25,height:25,borderRadius:0,position:"absolute",right:5,top:5}};var g=n(11023),f=n(19663),m=n(22805),A=n(24414),E=n(40067),p=n(85448),S=n(17279),h=n(36524),v=n(76003),y=n(62719),R=n(80634),T=n(85347),C=n(89231),I=n(90246),O=n(45246),P=n(90889);const U="100000";let D=function(e){return e.ScreenShare="screenshare",e}({});const Z=e=>{const t=(new Date).getTime(),n=(0,l.cu)(),{callActive:a}=e,{rtcProps:o}=(0,r.useContext)(l.UE),{dispatch:i}=(0,r.useContext)(l.qU),{defaultContent:s,activeUids:c}=(0,E.r0)(),d=(0,r.useRef)({defaultContent:s}),g=(0,r.useRef)({activeUids:c}),{waitingRoomStatus:Z,data:{isHost:b}}=(0,I.xS)(),w=(0,r.useRef)({waitingRoomStatus:Z}),B=(0,r.useRef)({isHost:b});(0,r.useEffect)((()=>{B.current.isHost=b}),[b]),(0,r.useEffect)((()=>{w.current.waitingRoomStatus=Z}),[Z]),(0,r.useEffect)((()=>{g.current.activeUids=c}),[c]),(0,r.useEffect)((()=>{d.current.defaultContent=s}),[s]);const[F,M]=(0,r.useState)(!1),[N,k]=(0,r.useState)(!1),[L,_]=(0,r.useState)(0);let x=(0,r.useRef)(null);const W=(0,r.useRef)(5);r.useEffect((()=>{_(Object.keys((0,y.v7)(s,(([e,t])=>"rtc"===(null==t?void 0:t.type)&&!t.offline&&-1!==c.indexOf(null==t?void 0:t.uid)))).length)}),[s]),r.useEffect((()=>{{const e=e=>(e.preventDefault(),e.returnValue="Are you sure you want to exit?"),t=()=>{x.current.leaveChannel(o.channel)};if(!(0,u.lv)())return;return window.addEventListener("beforeunload",(0,u.$L)()&&!(0,T.Z)()?e:()=>{}),window.addEventListener("pagehide",t),()=>{window.removeEventListener("beforeunload",(0,u.$L)()&&!(0,T.Z)()?e:()=>{}),window.removeEventListener("pagehide",t)}}}),[]);const V=async()=>{try{P.kg.log(P.O3.AgoraSDK,"API","RTM login starts"),await x.current.login({uid:n.toString(),token:o.rtm}),P.kg.log(P.O3.AgoraSDK,"API","RTM login done"),v.Z.getInstance().setLocalUID(n.toString()),P.kg.log(P.O3.AgoraSDK,"API","RTM local Uid set"),W.current=5,await K(),P.kg.log(P.O3.AgoraSDK,"Log","RTM setting attribute done")}catch(e){P.kg.error(P.O3.AgoraSDK,"Log","RTM login failed..Trying again"),setTimeout((async()=>{W.current=W.current+W.current,V()}),1e3*W.current)}},K=async()=>{const e=[{key:"screenUid",value:String(o.screenShareUid)},{key:"isHost",value:String(B.current.isHost)}];try{await x.current.setLocalUserAttributes(e),P.kg.log(P.O3.AgoraSDK,"API","RTM setting local user attributes",{attr:e}),W.current=5,await H(),P.kg.log(P.O3.AgoraSDK,"Log","RTM join channel done",{data:e}),M(!0),await j(),k(!0),P.kg.log(P.O3.AgoraSDK,"Log","RTM queued events finished running",{attr:e})}catch(e){P.kg.error(P.O3.AgoraSDK,"Log","RTM setAttribute failed..Trying again"),setTimeout((async()=>{W.current=W.current+W.current,K()}),1e3*W.current)}},H=async()=>{try{v.Z.getInstance().channelUid!==o.channel?(await x.current.joinChannel(o.channel),P.kg.log(P.O3.AgoraSDK,"API","RTM joinChannel",{data:o.channel}),v.Z.getInstance().setChannelId(o.channel),P.kg.log(P.O3.AgoraSDK,"API","RTM setChannelId",o.channel),P.kg.debug(P.O3.SDK,"Event","Emitting rtm joined",o.channel),R.Z.emit("_rtm-joined",o.channel)):P.kg.debug(P.O3.AgoraSDK,"Log","RTM already joined channel skipping",o.channel),W.current=5,await Q(),await G(),P.kg.log(P.O3.AgoraSDK,"Log","RTM getMembers done")}catch(e){P.kg.error(P.O3.AgoraSDK,"Log","RTM joinChannel failed..Trying again"),setTimeout((async()=>{W.current=W.current+W.current,H()}),1e3*W.current)}},J=(e,t)=>{i({type:"UpdateRenderList",value:[e,t]})},Q=async()=>{try{P.kg.log(P.O3.AgoraSDK,"API","RTM getChannelMembersByID(getMembers) start"),await x.current.getChannelMembersBychannelId(o.channel).then((async e=>{P.kg.log(P.O3.AgoraSDK,"API","RTM getChannelMembersByID data received",e),await Promise.all(e.members.map((async e=>{const t=(0,A.backOff)((async()=>{P.kg.log(P.O3.AgoraSDK,"API",`RTM fetching getUserAttributesByUid for member ${e.uid}`);const t=await x.current.getUserAttributesByUid(e.uid);if(!t||!t.attributes)throw P.kg.log(P.O3.AgoraSDK,"API","RTM attributes for member not found"),t;P.kg.log(P.O3.AgoraSDK,"API",`RTM getUserAttributesByUid for member ${e.uid} received`,{attr:t});for(const e in t.attributes){if(t.attributes.hasOwnProperty(e)&&t.attributes[e])return t;throw t}}),{retry:(t,n)=>(P.kg.debug(P.O3.AgoraSDK,"Log",`[retrying] Attempt ${n}. Fetching ${e.uid}'s name`,t),!0)});try{var n,r;const a=await t;console.log("[user attributes]:",{attr:a});const o=parseInt(e.uid),i=parseInt(null==a||null===(n=a.attributes)||void 0===n?void 0:n.screenUid),l={screenUid:i,type:o===parseInt(U)?"bot":"rtc",uid:o,offline:!1,isHost:null==a||null===(r=a.attributes)||void 0===r?void 0:r.isHost,lastMessageTimeStamp:0};J(o,l);const s={type:D.ScreenShare,parentUid:o};J(i,s);for(const[t,n]of Object.entries(null==a?void 0:a.attributes))if((0,p.Vr)(n)){const r={evt:t,value:n};S.gQ.enqueue({data:r,uid:e.uid,ts:(0,p.dZ)()})}}catch(t){P.kg.error(P.O3.AgoraSDK,"Log",`Could not retrieve name of ${e.uid}`,t)}}))),P.kg.debug(P.O3.AgoraSDK,"Log","RTM fetched all data and user attr...RTM init done")})),W.current=5}catch(e){setTimeout((async()=>{W.current=W.current+W.current,await Q()}),1e3*W.current)}},G=async()=>{try{await x.current.getChannelAttributes(o.channel).then((async e=>{for(const t of e){const{key:e,value:n,lastUpdateTs:r,lastUpdateUserId:a}=t;if((0,p.Vr)(n)){const t={evt:e,value:n};S.gQ.enqueue({data:t,uid:a,ts:r})}}P.kg.log(P.O3.AgoraSDK,"API","RTM getChannelAttributes data received",e)})),W.current=5}catch(e){setTimeout((async()=>{W.current=W.current+W.current,await G()}),1e3*W.current)}},j=async()=>{try{for(;!S.gQ.isEmpty();){const e=S.gQ.dequeue();await X(e.data,e.uid,e.ts)}}catch(e){P.kg.error(P.O3.Events,"CUSTOM_EVENTS","error while running queue events",e)}},X=async(e,t,n)=>{console.debug(P.O3.Events,"CUSTOM_EVENTS","inside eventDispatcher ",e);let r="",a={};if("WAITING_ROOM"===e.feat){if("REQUEST"===e.etyp){const t={evt:`${e.feat}_${e.etyp}`,payload:JSON.stringify({attendee_uid:e.data.data.attendee_uid,attendee_screenshare_uid:e.data.data.attendee_screenshare_uid}),persistLevel:1,source:"core"},n=JSON.stringify(t);r=e.feat+"_"+e.etyp,a=n}if("RESPONSE"===e.etyp){var o;const t={evt:`${e.feat}_${e.etyp}`,payload:JSON.stringify({approved:e.data.data.approved,channelName:e.data.data.channel_name,mainUser:e.data.data.mainUser,screenShare:e.data.data.screenShare,whiteboard:e.data.data.whiteboard,chat:null===(o=e.data.data)||void 0===o?void 0:o.chat}),persistLevel:1,source:"core"},n=JSON.stringify(t);r=e.feat+"_"+e.etyp,a=n}}else r=e.evt,a=e.value;try{const{payload:e,persistLevel:o,source:i}=JSON.parse(a);if(o===h.o2.Session){const e={key:r,value:a};await x.current.addOrUpdateLocalUserAttributes([e])}console.debug(P.O3.Events,"CUSTOM_EVENTS","emiting event..: "),S.RZ.emitEvent(r,i,{payload:e,persistLevel:o,sender:t,ts:n}),"name"===r&&setTimeout((()=>{S.RZ.emitEvent(r,i,{payload:e,persistLevel:o,sender:t,ts:n})}),200)}catch(e){console.error(P.O3.Events,"CUSTOM_EVENTS","error while emiting event:",e)}};return(0,C.bd)((async()=>(a&&await(async()=>{var e,t;"CONNECTED"!==(null==x||null===(e=x.current)||void 0===e||null===(t=e.client)||void 0===t?void 0:t.connectionState)&&(P.kg.log(P.O3.AgoraSDK,"Log","RTM creating engine..."),x.current=v.Z.getInstance().engine,v.Z.getInstance(),P.kg.log(P.O3.AgoraSDK,"Log","RTM engine creation done"),x.current.on("connectionStateChanged",(e=>{})),x.current.on("error",(e=>{})),x.current.on("channelMemberJoined",(e=>{P.kg.log(P.O3.AgoraSDK,"Event","channelMemberJoined",e);const t=(0,A.backOff)((async()=>{P.kg.log(P.O3.AgoraSDK,"API",`RTM fetching getUserAttributesByUid for member ${e.uid}`);const t=await x.current.getUserAttributesByUid(e.uid);if(!t||!t.attributes)throw P.kg.log(P.O3.AgoraSDK,"API","RTM attributes for member not found"),t;P.kg.log(P.O3.AgoraSDK,"API",`RTM getUserAttributesByUid for member ${e.uid} received`,{attr:t});for(const e in t.attributes){if(t.attributes.hasOwnProperty(e)&&t.attributes[e])return t;throw t}}),{retry:(t,n)=>(P.kg.debug(P.O3.AgoraSDK,"Log",`[retrying] Attempt ${n}. Fetching ${e.uid}'s name`,t),!0)});!async function(){try{var n,r;const a=await t;console.log("[user attributes]:",{attr:a});const o=parseInt(e.uid),i=parseInt(null==a||null===(n=a.attributes)||void 0===n?void 0:n.screenUid),l={screenUid:i,type:o===parseInt(U)?"bot":"rtc",uid:o,offline:!1,lastMessageTimeStamp:0,isHost:null==a||null===(r=a.attributes)||void 0===r?void 0:r.isHost};J(o,l);const s={type:D.ScreenShare,parentUid:o};J(i,s)}catch(t){P.kg.error(P.O3.AgoraSDK,"Event",`Failed to retrive name of ${e.uid}`,t)}}()})),x.current.on("channelMemberLeft",(e=>{P.kg.debug(P.O3.AgoraSDK,"Event","channelMemberLeft",e);const t=null!=e&&e.uid?parseInt(null==e?void 0:e.uid):void 0;t&&(R.Z.emit("_rtm-left",t),J(t,{offline:!0}))})),x.current.addListener("ChannelAttributesUpdated",(e=>{try{e.map((e=>{const{key:t,value:n,lastUpdateTs:r,lastUpdateUserId:a}=e,o=(0,p.AV)(r),i=m.Z.OS?(0,p.pe)(a):parseInt(a);X({evt:t,value:n},i,o)}))}catch(e){P.kg.error(P.O3.Events,"CUSTOM_EVENTS","error while dispatching through eventDispatcher",e)}})),x.current.on("messageReceived",(e=>{P.kg.debug(P.O3.Events,"CUSTOM_EVENTS","messageReceived",e);const{peerId:t,ts:n,text:r}=e,[a,o]=(0,p.D6)(r);a&&P.kg.error(P.O3.Events,"CUSTOM_EVENTS","JSON payload incorrect, Error while parsing the payload",a);const i=(0,p.AV)(n),l=(0,u.Dt)()?(0,p.pe)(t):parseInt(t);try{X(o,l,i)}catch(e){P.kg.error(P.O3.Events,"CUSTOM_EVENTS","error while dispatching through eventDispatcher",a)}})),x.current.on("channelMessageReceived",(e=>{P.kg.debug(P.O3.Events,"CUSTOM_EVENTS","channelMessageReceived",e);const{uid:t,channelId:n,text:r,ts:a}=e;if(1010101==t){var i,l;const[e,t]=(0,p.D6)(r);var s,c;e&&P.kg.error(P.O3.Events,"CUSTOM_EVENTS","JSON payload incorrect, Error while parsing the payload",e),null!=t&&null!==(i=t.data)&&void 0!==i&&null!==(l=i.data)&&void 0!==l&&l.images&&O.Z.emit(O.M.WHITEBOARD_FILE_UPLOAD,null==t||null===(s=t.data)||void 0===s||null===(c=s.data)||void 0===c?void 0:c.images)}else{const[e,i]=(0,p.D6)(r);e&&P.kg.error(P.O3.Events,"CUSTOM_EVENTS","JSON payload incorrect, Error while parsing the payload",e);const l=(0,p.AV)(a),s=m.Z.OS?(0,p.pe)(t):parseInt(t);if(n===o.channel)try{X(i,s,l)}catch(e){P.kg.error(P.O3.Events,"CUSTOM_EVENTS","error while dispatching through eventDispatcher",e)}}})),await V())})(),async()=>{await(async()=>{a&&(await v.Z.getInstance().destroy(),P.kg.log(P.O3.AgoraSDK,"API","RTM destroy done"),((0,u.gn)()||(0,u.Dt)())&&S.RZ.clear(),M(!1),P.kg.debug(P.O3.AgoraSDK,"Log","RTM cleanup done"))})()})),[o.channel,o.appId,a]),r.createElement(f.ZP.Provider,{value:{isInitialQueueCompleted:N,rtmInitTimstamp:t,hasUserJoinedRTM:F,engine:x.current,localUid:n,onlineUsersCount:L}},e.children)};var b=n(97778),w=n(88548),B=n(63250);function F(){const e=(0,g.k6)();return r.createElement(w.Z,{onPress:()=>e.replace("/")},r.createElement(B.Z,{source:{uri:"data:image/jpeg;base64,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"},style:M.logo,resizeMode:"contain"}))}const M=i.Z.create({logo:{minWidth:60,minHeight:30},marginAuto:{width:"30%",height:"30%",minWidth:60,minHeight:30}});var N=n(79088),k=n(78459),L=n(32827),_=n(85565),x=n(8894),W=n(75881),V=n(48389),K=n(77829),H=n(93812);L.x.Consumer;const J=e=>{const t=(0,K.ZW)(H.sBt)(),n=(0,K.ZW)(H.f0o)(),[a,o]=(0,r.useState)(!1),{dispatch:i}=(0,r.useContext)(l.qU),s=(0,E.oT)(),{defaultContent:c,activeUids:u,pinnedUid:d,secondaryPinnedUid:g}=(0,E.r0)(),f=(0,r.useRef)(0),{setScreenShareData:m,screenShareData:A}=(0,x.q)(),v=(0,_.WX)(),R=(0,_._O)(),{currentLayout:T}=(0,E.$Y)(),C=(0,r.useRef)({currentLayout:T}),{executeNormalQuery:I,executePresenterQuery:O}=(0,W.Z)(),{channel:U,appId:D,screenShareUid:Z,screenShareToken:b,encryption:w}=(0,r.useContext)(l.UE).rtcProps,B=(0,r.useRef)({defaultContent:c}),F=(0,r.useRef)({pinnedUid:d}),M=(0,r.useRef)({secondaryPinnedUid:g});(0,r.useEffect)((()=>{F.current.pinnedUid=d}),[d]),(0,r.useEffect)((()=>{M.current.secondaryPinnedUid=g}),[g]),(0,r.useEffect)((()=>{B.current.defaultContent=c}),[c]),(0,r.useEffect)((()=>{C.current.currentLayout=T}),[T]),(0,r.useEffect)((()=>{const e=(0,y.v7)(A,(([e,t])=>null==t?void 0:t.isActive));if(e){const n=Object.keys(e).map((e=>parseInt(e))).sort(((t,n)=>e[t].ts-e[n].ts));var t;null!=n&&n.length&&(n.reverse(),f.current!==n[0]&&-1!==u.indexOf(n[0])&&N(!0,n[0],null===(t=B.current.defaultContent[n[0]])||void 0===t?void 0:t.parentUid))}}),[u,A]);const N=(e,t,n)=>{let r=C.current.currentLayout;e&&t?(f.current=t,i({type:"UserPin",value:[t]}),n&&!M.current.secondaryPinnedUid?i({type:"UserSecondaryPin",value:[n]}):n&&M.current.secondaryPinnedUid&&i({type:"ActiveSpeaker",value:[n]}),r!==(0,_.WK)()&&v()):(f.current=0,r!==(0,_.dz)()&&R())};(0,r.useEffect)((()=>{const e=h.ZP.on(E.Pu.kickScreenshare,(()=>{s.RtcEngineUnsafe.startScreenshare()})),t=h.ZP.on(S.Vy.SCREENSHARE_ATTRIBUTE,(e=>{const t=JSON.parse(e.payload),n=t.action,r=t.value;if(null!=e&&e.sender){var a;let o=null===(a=B.current.defaultContent[null==e?void 0:e.sender])||void 0===a?void 0:a.screenUid;if(o||(o=null==t?void 0:t.screenUidOfUser),o)switch(n){case S.DI.SCREENSHARE_STARTED:m((e=>{var t;return{...e,[o]:{name:null===(t=B.current.defaultContent[o])||void 0===t?void 0:t.name,isActive:!0,ts:r||0}}}));break;case S.DI.SCREENSHARE_STOPPED:m((e=>{var t;return{...e,[o]:{name:null===(t=B.current.defaultContent[o])||void 0===t?void 0:t.name,isActive:!1,ts:r||0}}})),F.current.pinnedUid||N(!1),o===F.current.pinnedUid&&(N(!1),i({type:"UserPin",value:[0]}))}}}));return()=>{e(),t()}}),[]);const k=()=>{o(!1),P.kg.debug(P.O3.Internals,"SCREENSHARE","screenshare stopped."),h.ZP.send(S.Vy.SCREENSHARE_ATTRIBUTE,JSON.stringify({action:S.DI.SCREENSHARE_STOPPED,value:0}),h.o2.Sender),m((e=>({...e,[Z]:{...e[Z],isActive:!1,ts:0}}))),F.current.pinnedUid||N(!1),Z===F.current.pinnedUid&&(N(!1),i({type:"UserPin",value:[0]}))};(0,r.useEffect)((()=>{s.RtcEngineUnsafe.addListener("onScreenshareStopped",k)}),[]);const J=async r=>{P.kg.log(P.O3.Internals,"SCREENSHARE",(r?"starting":"stopping")+"  screenshare",{channel:U,screenShareUid:Z,encryption:w});try{e.isRecordingActive&&(r?(P.kg.log(P.O3.Internals,"SCREENSHARE","Recording is going on set presenter query"),O(Z)):(P.kg.log(P.O3.Internals,"SCREENSHARE","Recording is NOT going on set normal query"),I())),await s.RtcEngineUnsafe.startScreenshare(b,U,null,Z,D,s.RtcEngineUnsafe,w,{encoderConfig:"1080p_2",optimizationMode:"detail"}),r&&o(!0),r&&(m((e=>{var t;return{...e,[Z]:{name:null===(t=B.current.defaultContent[Z])||void 0===t?void 0:t.name,isActive:!0,ts:(0,p.dZ)()}}})),h.ZP.send(S.Vy.SCREENSHARE_ATTRIBUTE,JSON.stringify({action:S.DI.SCREENSHARE_STARTED,value:(0,p.dZ)(),screenUidOfUser:Z}),h.o2.Sender))}catch(e){P.kg.error(P.O3.Internals,"SCREENSHARE","failed to start screen share",e),V.Z.show({leadingIconName:"alert",type:"error",text1:t,text2:n,visibilityTime:1e4,primaryBtn:null,secondaryBtn:null})}};return r.createElement(L.x.Provider,{value:{isScreenshareActive:a,startScreenshare:()=>{a||J(!0)},stopScreenshare:()=>{a&&J(!1)},ScreenshareStoppedCallback:k}},e.children)};var Q=n(12870),G=n(37763),j=n(28821),X=n(76386),z=n(97010),q=n(66063),Y=n(67535),$=n(51666),ee=n(69628),te=n(1271),ne=n(45607),re=n(68224),ae=n(9117),oe=n(27127),ie=n(54304),le=n(50939),se=n(28990),ce=n(57106),ue=n(67911),de=n(84787),ge=n(73803);const fe=({callActive:e,children:t,setSttAutoStarted:n,sttAutoStarted:a})=>{const{isRecordingBot:o}=(0,ge.P)(),i=(0,r.useRef)(void 0),s=(0,K.ZW)(H.V1F)(H.r1d.audio),c=(0,r.useRef)(s);(0,r.useEffect)((()=>{c.current=s}),[s]);const d=(0,K.ZW)(H.V1F)(H.r1d.video),g=(0,r.useRef)(d);(0,r.useEffect)((()=>{g.current=d}),[d]);const m=(0,K.ZW)(H.zz)(H.r1d.video),A=(0,r.useRef)(m);(0,r.useEffect)((()=>{A.current=m}),[m]);const p=(0,K.ZW)(H.zz)(H.r1d.audio),v=(0,r.useRef)(p);(0,r.useEffect)((()=>{v.current=p}),[p]);const y=(0,K.ZW)(H.DCy)(H.r1d.video),R=(0,r.useRef)(y);(0,r.useEffect)((()=>{R.current=y}),[y]);const T=(0,K.ZW)(H.DCy)(H.r1d.audio),C=(0,r.useRef)(T);(0,r.useEffect)((()=>{C.current=T}),[T]);const P=(0,K.ZW)(H.OF4)(H.r1d.video),U=(0,r.useRef)(P);(0,r.useEffect)((()=>{U.current=P}),[P]);const D=(0,K.ZW)(H.OF4)(H.r1d.audio),Z=(0,r.useRef)(D);(0,r.useEffect)((()=>{Z.current=D}),[D]);const b=(0,K.ZW)(H.Gvu)(),w=(0,de.Z)(),B=(0,r.useRef)(b);(0,r.useEffect)((()=>{B.current=b}),[b]);const F=(0,K.ZW)(H.UpT)(),M=(0,r.useRef)(F);(0,r.useEffect)((()=>{M.current=F}),[F]);const N=(0,K.ZW)(H.HEQ),k=(0,r.useRef)(N);(0,r.useEffect)((()=>{k.current=N}),[N]);const L=(0,K.ZW)(H.FE6)(),_=(0,r.useRef)(L);(0,r.useEffect)((()=>{_.current=L}),[L]);const x=(0,K.ZW)(H.q3o)(),W=(0,r.useRef)(x);(0,r.useEffect)((()=>{W.current=x}),[x]);const{dispatch:J}=(0,r.useContext)(l.qU),{RtcEngineUnsafe:Q}=(0,r.useContext)(l.I7),{defaultContent:G,activeUids:j}=(0,E.r0)(),X=(0,r.useRef)({defaultContent:G});(0,r.useEffect)((()=>{X.current.defaultContent=G}),[G]);const{data:{isHost:z,roomId:q},roomPreference:{userRemovalTimeout:Y}}=(0,I.xS)(),{setRoomInfo:$}=(0,le.P)(),ee=r.useRef(z),{permissionStatus:te}=(0,E.DM)(),ne=r.useRef(te),{waitingRoomUids:re,waitingRoomRef:ae}=(0,se.S)(),oe=r.useRef(re),{approval:fe}=(0,ce.Z)(),pe=(0,l.cu)(),Se=r.useRef(j),{authLogin:he}=(0,ue.a)();r.useEffect((()=>{Se.current=j}),[j]),(0,r.useEffect)((()=>{ee.current=z}),[z]),(0,r.useEffect)((()=>{ne.current=te}),[te]);const{hasUserJoinedRTM:ve,isInitialQueueCompleted:ye}=(0,r.useContext)(f.ZP),{startSpeechToText:Re,addStreamMessageListener:Te}=(0,E.Ii)();return(0,r.useEffect)((()=>{}),[o,e,z,ve,q,a,ye,i.current]),(0,r.useEffect)((()=>{h.ZP.on(f.Pu.muteVideo,(async({payload:t,sender:n})=>{V.Z.show({leadingIconName:"video-off",type:"info",text1:g.current,visibilityTime:3e3,primaryBtn:null,secondaryBtn:null,leadingIcon:null}),(0,u.lv)()?await Q.muteLocalVideoStream(!0):await Q.enableLocalVideo(!1),await e(!0),J({type:"LocalMuteVideo",value:[0]})})),h.ZP.on(f.Pu.muteAudio,(async({sender:e})=>{V.Z.show({leadingIconName:"mic-off",type:"info",text1:c.current,visibilityTime:3e3,primaryBtn:null,secondaryBtn:null,leadingIcon:null}),(0,u.lv)()?await Q.muteLocalAudioStream(!0):await Q.enableLocalAudio(!1),J({type:"LocalMuteAudio",value:[0]})})),h.ZP.on(f.Pu.kickUser,(async()=>{try{O.Z.emit(O.M.USER_KICKED_OFF_BY_REMOTE_HOST)}catch(e){console.log("error on stop the screeshare",e)}V.Z.show({leadingIconName:"info",type:"info",text1:B.current,visibilityTime:5e3,primaryBtn:null,secondaryBtn:null}),Y>0?setTimeout((()=>{w()}),Y):w()})),h.ZP.on(f.Pu.requestAudio,(()=>{V.Z.show({leadingIconName:"mic-on",type:"info",text1:v.current,visibilityTime:3e3,leadingIcon:null,primaryBtn:ne.current===l.eg.GRANTED_FOR_CAM_AND_MIC||ne.current===l.eg.GRANTED_FOR_MIC_ONLY?r.createElement(Ee,{containerStyle:me.primaryBtn,textStyle:me.textStyle,text:C.current,onPress:async()=>{(0,u.lv)()?await Q.muteLocalAudioStream(!1):await Q.enableLocalAudio(!0),J({type:"LocalMuteAudio",value:[1]}),V.Z.hide()}}):null,secondaryBtn:ne.current===l.eg.GRANTED_FOR_CAM_AND_MIC||ne.current===l.eg.GRANTED_FOR_MIC_ONLY?r.createElement(Ae,{text:Z.current}):null})})),h.ZP.on(f.Pu.requestVideo,(()=>{V.Z.show({leadingIconName:"video-on",type:"info",text1:A.current,visibilityTime:3e3,leadingIcon:null,primaryBtn:ne.current===l.eg.GRANTED_FOR_CAM_AND_MIC||ne.current===l.eg.GRANTED_FOR_CAM_ONLY?r.createElement(Ee,{containerStyle:me.primaryBtn,textStyle:me.textStyle,text:R.current,onPress:async()=>{(0,u.lv)()?await Q.muteLocalVideoStream(!1):await Q.enableLocalVideo(!0),await e(!1),J({type:"LocalMuteVideo",value:[1]}),V.Z.hide()}}):null,secondaryBtn:ne.current===l.eg.GRANTED_FOR_CAM_AND_MIC||ne.current===l.eg.GRANTED_FOR_CAM_ONLY?r.createElement(Ae,{text:U.current}):null})})),h.ZP.on(S.Vy.WHITEBOARD_ACTIVE,(({payload:e})=>{const t=JSON.parse(e);t&&null!=t&&t.status,O.Z.emit(O.M.WHITEBOARD_ACTIVE_LOCAL,{status:null==t?void 0:t.status})})),h.ZP.on(S.Vy.BOARD_COLOR_CHANGED,(({payload:e})=>{const t=JSON.parse(e);null!=t&&t.boardColor&&O.Z.emit(O.M.BOARD_COLOR_CHANGED_LOCAL,{boardColor:null==t?void 0:t.boardColor})})),h.ZP.on(S.Vy.WHITEBOARD_LAST_IMAGE_UPLOAD_POSITION,(({payload:e})=>{const t=JSON.parse(e);O.Z.emit(O.M.WHITEBOARD_LAST_IMAGE_UPLOAD_POSITION_LOCAL,{height:(null==t?void 0:t.height)||0})})),h.ZP.on(S.Vy.STT_ACTIVE,(e=>{const t=JSON.parse(null==e?void 0:e.payload);t.active?i.current=!0:i.current=!1,$((e=>({...e,isSTTActive:t.active})))})),h.ZP.on(S.Vy.STT_LANGUAGE,(e=>{const{username:t,prevLang:n,newLang:r,uid:a}=JSON.parse(null==e?void 0:e.payload),o={username:t,prevLang:n,newLang:r,uid:a,langChanged:!0};$((e=>({...e,sttLanguage:o})))})),h.ZP.on(S.Vy.WAITING_ROOM_STATUS_UPDATE,(e=>{if(!ee.current)return;const{attendee_uid:t,approved:n}=JSON.parse(null==e?void 0:e.payload);J({type:"UpdateRenderList",value:[t,{isInWaitingRoom:!1}]}),ae.current[t]=n?"APPROVED":"REJECTED",V.Z.getToastId()===t&&V.Z.hide()})),h.ZP.on(S.Vy.WAITING_ROOM_REQUEST,(e=>{var t;if(!ee.current)return;console.log("waitingRoomRef on WAITING_ROOM_REQUEST",ae.current);const{attendee_uid:n,attendee_screenshare_uid:a}=JSON.parse(null==e?void 0:e.payload);if(""==n)return;if(-1!==Se.current.indexOf(n))return void console.log("debugging in active uids");if(-1!==oe.current.indexOf(n))return void console.log("debugging in waitingRoomUidsRef");if(ae.current[n]&&("PENDING"===ae.current[n]||"APPROVED"===ae.current[n]))return;const o=(null===(t=X.current.defaultContent[n])||void 0===t?void 0:t.name)||"Attendee";J({type:"UpdateRenderList",value:[n,{isInWaitingRoom:!0}]}),ae.current[n]="PENDING";let i={};i.toastId=n,i.primaryBtn=r.createElement(Ee,{containerStyle:me.primaryBtn,textStyle:me.textStyle,text:_.current,onPress:()=>{fe({host_uid:pe,attendee_uid:n,attendee_screenshare_uid:a,approved:!0}),J({type:"UpdateRenderList",value:[n,{isInWaitingRoom:!1}]}),ae.current[n]="APPROVED",console.log("waitingRoomRef on APPROVAL",ae.current),h.ZP.send(S.Vy.WAITING_ROOM_STATUS_UPDATE,JSON.stringify({attendee_uid:n,approved:!0}),h.o2.None),V.Z.hide()}}),i.secondaryBtn=r.createElement(ie.Z,{containerStyle:me.secondaryBtn,textStyle:me.textStyle,text:W.current,onPress:()=>{const e=fe({host_uid:pe,attendee_uid:n,attendee_screenshare_uid:a,approved:!1});J({type:"UpdateRenderList",value:[n,{isInWaitingRoom:!1}]}),ae.current[n]="REJECTED",console.log("waitingRoomRef on REJECTION",ae.current),h.ZP.send("WAITING_ROOM_STATUS_UPDATE",JSON.stringify({attendee_uid:n,approved:!1}),h.o2.None),console.log("waiting-room:reject",e),V.Z.hide()}}),V.Z.show({leadingIconName:"info",leadingIcon:null,type:"info",text1:M.current,text2:k.current(o),visibilityTime:3e4,...i})}));const e=async e=>{(0,u.Dt)()||(0,u.gn)()};return()=>{h.ZP.off(f.Pu.requestAudio),h.ZP.off(f.Pu.requestVideo),h.ZP.off(f.Pu.muteVideo),h.ZP.off(f.Pu.muteAudio),h.ZP.off(f.Pu.kickUser),h.ZP.off(S.Vy.WAITING_ROOM_REQUEST),h.ZP.off(S.Vy.WAITING_ROOM_STATUS_UPDATE),h.ZP.off(S.Vy.WHITEBOARD_ACTIVE),h.ZP.off(S.Vy.WHITEBOARD_LAST_IMAGE_UPLOAD_POSITION),h.ZP.off(S.Vy.BOARD_COLOR_CHANGED),h.ZP.off(S.Vy.STT_ACTIVE),h.ZP.off(S.Vy.STT_LANGUAGE)}}),[]),r.createElement(r.Fragment,null,t)},me=i.Z.create({secondaryBtn:{marginLeft:12,paddingVertical:6,paddingHorizontal:10},primaryBtn:{borderRadius:4,backgroundColor:"#099DFD",paddingHorizontal:10,paddingVertical:7},textStyle:{fontFamily:c.Z.FontFamily.sansPro,fontWeight:"600",fontSize:14,lineHeight:14,color:"#FFFFFF"}}),Ae=e=>r.createElement(ie.Z,{containerStyle:me.secondaryBtn,textStyle:me.textStyle,text:(null==e?void 0:e.text)||"LATER",onPress:()=>{V.Z.hide()}}),Ee=e=>{const{text:t,containerStyle:n,textStyle:a,onPress:i}=e;return r.createElement(w.Z,{style:n,onPress:i},r.createElement(o.Z,{style:a},t))};var pe=n(27771);const Se=n.p+"4654d2832744cc3c1b9f75a433a7d91a.png";var he=n(69135);const ve=i.Z.create({dismissBtn:{fontFamily:c.Z.FontFamily.sansPro,fontWeight:"600",fontSize:c.Z.FontSize.normal,color:"#099DFD",paddingVertical:32},infoMessage1:{paddingHorizontal:76,paddingTop:32,paddingBottom:12,fontFamily:c.Z.FontFamily.sansPro,fontWeight:"700",fontSize:c.Z.FontSize.large,textAlign:"center",color:"#FFFFFF"},infoMessage2:{fontFamily:c.Z.FontFamily.sansPro,fontWeight:"400",fontSize:c.Z.FontSize.small,color:"#FFFFFF"+c.Z.EmphasisPlus.medium},infoMessage2Highlight:{fontWeight:"700",fontFamily:c.Z.FontFamily.sansPro,fontSize:c.Z.FontSize.small},modal:{flex:1,flexDirection:"column",maxHeight:386,width:441,borderRadius:20,paddingHorizontal:0,paddingVertical:0,borderWidth:0},modalImageContainer:{minHeight:190},modalImage:{width:"100%",height:"100%"},modalContent:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#1D1D1D",borderBottomLeftRadius:20,borderBottomRightRadius:20}}),ye=()=>{const e=(0,K.ZW)(he.oG)({audioRoom:!1}),t=(0,K.ZW)(he.CI)({audioRoom:!1}),n=(0,K.ZW)(he.mp)(),{dispatch:i}=(0,r.useContext)(l.qU),{permissionStatus:s}=(0,E.DM)(),[c,u]=(0,r.useState)(!1),d=()=>{i({type:"LocalPermissionState",value:[l.eg.CANCELLED]})};return(0,r.useEffect)((()=>{Promise.all([navigator.permissions.query({name:"camera"}),navigator.permissions.query({name:"microphone"})]).then((([e,t])=>{if("granted"!==e.state||"granted"!==t.state){u(!0);const n=()=>{"granted"===e.state&&"granted"===t.state&&u(!1)};t.onchange=n,e.onchange=n}})).catch((e=>{u(!0)})),setTimeout((()=>{s===l.eg.REQUESTED&&u(!0)}),1e3)}),[]),c&&r.createElement(pe.Z,{modalVisible:s===l.eg.REQUESTED,setModalVisible:d,showCloseIcon:!1,contentContainerStyle:ve.modal},r.createElement(a.Z,{style:ve.modalImageContainer},r.createElement(B.Z,{style:ve.modalImage,resizeMode:"contain",source:{uri:Se}})),r.createElement(a.Z,{style:ve.modalContent},r.createElement(o.Z,{style:ve.infoMessage1},e),r.createElement(o.Z,{style:ve.infoMessage2},t),r.createElement(w.Z,{onPress:()=>{d()}},r.createElement(o.Z,{style:ve.dismissBtn},n))))};var Re=n(68460),Te=n(4363),Ce=n(37848),Ie=n(16727),Oe=n(70474),Pe=n(41186),Ue=n(9266),De=n(11465),Ze=n(24713),be=n(86370),we=n(91140),Be=n(80015),Fe=(n(63384),n(56298)),Me=n(17630);const Ne=()=>{const e=(0,g.TH)(),{setDisplayName:t}=(0,oe.I)(),n=(0,u.xU)(null==e?void 0:e.search,"user_name");return(0,r.useEffect)((()=>{t(n)}),[]),r.createElement(Be.Z,null)},ke=()=>{const{rtcProps:e}=(0,r.useContext)(l.UE);let t;const{isUserBaned:n}=(0,E.r0)(),a=(0,E.mB)();(0,r.useEffect)((()=>{n&&a()}),[n]);const o=null!=e&&e.recordingBot?r.createElement(Ne,null):r.createElement(Be.Z,null);return t=(0,Me.A)("chatControl")?r.createElement(Fe.ZP,null,o):o,r.createElement(r.Fragment,null,t)};var Le=n(5709),_e=n(59056),xe=n(41882),We=function(e){return e[e.None=0]="None",e[e.AES128XTS=1]="AES128XTS",e[e.AES128ECB=2]="AES128ECB",e[e.AES256XTS=3]="AES256XTS",e[e.SM4128ECB=4]="SM4128ECB",e[e.AES256GCM=6]="AES256GCM",e[e.AES128GCM2=7]="AES128GCM2",e[e.AES256GCM2=8]="AES256GCM2",e}(We||{});const Ve={maxViewStyles:d.temp,minViewStyles:d.temp,localBtnContainer:d.bottomBar,localBtnStyles:{muteLocalAudio:d.localButton,muteLocalVideo:d.localButton,switchCamera:d.localButton,endCall:d.endCall,fullScreen:d.localButton,recording:d.localButton,screenshare:d.localButton},theme:"#099DFD",remoteBtnStyles:{muteRemoteAudio:d.remoteButton,muteRemoteVideo:d.remoteButton,remoteSwap:d.remoteButton,minCloseBtnStyles:d.minCloseBtn,liveStreamHostControlBtns:d.liveStreamHostControlBtns},BtnStyles:d.remoteButton},Ke=i.Z.create({full:{flex:1,flexDirection:"column",overflow:"hidden"},videoView:N.t_,loader:{flex:1,alignSelf:"center",justifyContent:"center"},loaderLogo:{alignSelf:"center",justifyContent:"center",marginBottom:30},loaderText:{fontWeight:"500",color:"#FFFFFF"}}),He=()=>{var e,t;const n=(0,u.Ej)(),i=(0,K.ZW)(H.NYR)(),s=(0,K.ZW)(H.eJx)(),{setGlobalErrorMessage:c}=(0,r.useContext)(Q.w5),{awake:d,release:f}=(0,ae.R)(),{isRecordingBot:m}=(0,ge.P)(),A=!!m,[E,p]=(0,r.useState)(A),[S,h]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),[C,O]=(0,r.useState)(!1),[U,D]=(0,r.useState)(!1),[w,B]=(0,r.useState)(!1),{phrase:M}=(0,g.UO)(),{store:N}=(0,r.useContext)(Pe.ZP),{join:L,microphoneDevice:_,cameraDevice:W,clearState:ie}=(0,r.useContext)(Ce.AO),ce=(0,Le.ae)((e=>{var t,n;return(null==e||null===(t=e.lifecycle)||void 0===t?void 0:t.useAfterEndCall)&&(null==e||null===(n=e.lifecycle)||void 0===n?void 0:n.useAfterEndCall())})),{PrefereceWrapper:ue}=(0,Le.ae)((e=>{var t,n,a;let o={PrefereceWrapper:r.Fragment};var i;return null!=e&&null!==(t=e.components)&&void 0!==t&&t.preferenceWrapper&&"object"!=typeof(null==e||null===(n=e.components)||void 0===n?void 0:n.preferenceWrapper)&&(0,u.Rp)(null==e||null===(a=e.components)||void 0===a?void 0:a.preferenceWrapper)&&(o.PrefereceWrapper=null==e||null===(i=e.components)||void 0===i?void 0:i.preferenceWrapper),o})),[de,me]=r.useState({appId:"4c59e38b93404737ae7e63ee679bac71",channel:null,uid:null,token:null,rtm:null,screenShareUid:null,screenShareToken:null,profile:"480p_8",screenShareProfile:"1080p_2",dual:!0,encryption:{key:null,mode:We.AES128GCM2,screenKey:null},role:l.h7.ClientRoleBroadcaster,geoFencing:!0,audioRoom:!1,activeSpeaker:!1,preferredCameraId:W.deviceId||(null==N||null===(e=N.activeDeviceId)||void 0===e?void 0:e.videoinput)||null,preferredMicrophoneId:_.deviceId||(null==N||null===(t=N.activeDeviceId)||void 0===t?void 0:t.audioinput)||null,recordingBot:!!m}),Ae=(0,g.k6)(),Ee=(0,r.useRef)(Ae.location.pathname),pe=(0,q.Z)(),{setRoomInfo:Se}=(0,le.P)(),{isJoinDataFetched:he,data:ve,isInWaitingRoom:Be,waitingRoomStatus:Fe}=(0,I.xS)();(0,r.useEffect)((()=>{var e,t;he&&P.kg.log(P.O3.Internals,"SET_MEETING_DETAILS","Room details",{user_id:(null==ve?void 0:ve.uid)||"",meeting_title:(null==ve?void 0:ve.meetingTitle)||"",channel_id:null==ve?void 0:ve.channel,host_id:(null==ve||null===(e=ve.roomId)||void 0===e?void 0:e.host)||"",attendee_id:(null==ve||null===(t=ve.roomId)||void 0===t?void 0:t.attendee)||""})}),[he,ve,M]),r.useEffect((()=>()=>{P.kg.debug(P.O3.Internals,"VIDEO_CALL_ROOM","Videocall unmounted"),Se((e=>({...I.EM,loginToken:null==e?void 0:e.loginToken}))),d&&f()}),[]),(0,r.useEffect)((()=>{L.phrase||pe(M,I.EM.roomPreference).then((()=>{P.kg.log(P.O3.Internals,"JOIN_MEETING","Join channel success")})).catch((e=>{const t=null==e?void 0:e.code;-1!==u.kq.indexOf(t)&&(0,T.Z)()&&R.Z.emit("unauthorized",e),P.kg.error(P.O3.Internals,"JOIN_MEETING","Join channel error",JSON.stringify(e||{})),c(e),Ae.push("/")}))}),[]),(0,r.useEffect)((()=>{if(!(0,T.Z)()||!L.initialized)return;const{phrase:e,meetingDetails:t,skipPrecall:n,promise:r,preference:a}=L,o=`/${e}`;p(n),t?(y(!1),Se((e=>({...e,isJoinDataFetched:!0,data:{...e.data,...t},roomPreference:a})))):e&&(y(!1),Ee.current=o,pe(e,a).then((()=>{P.kg.log(P.O3.Internals,"JOIN_MEETING","Join channel success")})).catch((e=>{const t=null==e?void 0:e.code;-1!==u.kq.indexOf(t)&&(0,T.Z)()&&R.Z.emit("unauthorized",e),P.kg.error(P.O3.Internals,"JOIN_MEETING","Join channel error",JSON.stringify(e||{})),c(e),Ae.push("/"),Ee.current="",r.rej(e)})))}),[L]),r.useEffect((()=>{!0!==he||v||(me((e=>({...e,channel:ve.channel,uid:ve.uid,token:ve.token,rtm:ve.rtmToken,encryption:{key:ve.encryptionSecret,mode:ve.encryptionMode,screenKey:ve.encryptionSecret,salt:ve.encryptionSecretSalt},screenShareUid:ve.screenShareUid,screenShareToken:ve.screenShareToken,role:ve.isHost?l.h7.ClientRoleBroadcaster:l.h7.ClientRoleAudience,preventJoin:!1}))),y(!0))}),[he,ve,v]);const Me={EndCall:()=>{ie("join"),setTimeout((()=>{R.Z.emit("leave"),ce?ce(ve.isHost,Ae):Ae.push("/")}),0)},UserJoined:e=>{console.log("UIKIT Callback: UserJoined",e),R.Z.emit("rtc-user-joined",e)},UserOffline:e=>{console.log("UIKIT Callback: UserOffline",e),R.Z.emit("rtc-user-left",e)},RemoteAudioStateChanged:(e,t)=>{console.log("UIKIT Callback: RemoteAudioStateChanged",e,t),0===t?R.Z.emit("rtc-user-unpublished",e,"audio"):R.Z.emit("rtc-user-published",e,"audio")},RemoteVideoStateChanged:(e,t)=>{console.log("UIKIT Callback: RemoteVideoStateChanged",e,t),0===t?R.Z.emit("rtc-user-unpublished",e,"video"):R.Z.emit("rtc-user-published",e,"video")},UserBanned(e){console.log("UIKIT Callback: UserBanned",e),V.Z.show({leadingIconName:"alert",type:"error",text1:s,visibilityTime:3e3})}};return r.createElement(r.Fragment,null,v?v||!E?r.createElement(r.Fragment,null,r.createElement(l.RX,{value:{rtcProps:{...de,callActive:E},callbacks:Me,styleProps:Ve,mode:l.po.ChannelProfileCommunication}},r.createElement(l.mP,null,r.createElement(b.Z,null,r.createElement(Ue.KE,{callActive:E},r.createElement(De.eN,null,r.createElement(te.wi,null,r.createElement(ee.s,null,r.createElement(j.a,null,r.createElement(Re.e,null,r.createElement(Y.d,null,r.createElement(we.Nw,{callActive:E},r.createElement(x.Y,null,r.createElement(Z,{callActive:E},r.createElement(oe.V,{callActive:E},r.createElement(Ie.Z,null,r.createElement(se.z,null,r.createElement(fe,{setSttAutoStarted:D,sttAutoStarted:U,callActive:E},r.createElement(J,{isRecordingActive:S},r.createElement(k.AO,{value:{setRtcProps:me,rtcProps:de,callActive:E}},r.createElement(ne.L,null,r.createElement(l.mk,{localUid:null==de?void 0:de.uid},r.createElement(z.R,{value:{setRecordingActive:h,isRecordingActive:S,callActive:E,recordingAutoStarted:w,setRecordingAutoStarted:B}},r.createElement($.yz,null,!(0,u.XW)()&&r.createElement(ye,null),r.createElement(xe.B,null,r.createElement(Ze.mZ,null,r.createElement(_e.cu,null,r.createElement(ue,{callActive:E,setCallActive:p},r.createElement(Oe.Z,null,E?r.createElement(re.O,null,r.createElement(Te.U,null,r.createElement(be.EX,null,r.createElement(ke,null)))):r.createElement(G.q,{value:{callActive:E,setCallActive:p}},r.createElement(X.Z,null))))))))))))))))))))))))))))))):r.createElement(a.Z,{style:Ke.loader},r.createElement(a.Z,{style:Ke.loaderLogo},n()&&r.createElement(F,null)),r.createElement(o.Z,{style:Ke.loaderText},i)):r.createElement(r.Fragment,null))}}}]);